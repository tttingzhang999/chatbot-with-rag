# HR Chatbot æ¶æ§‹æ”¹é€²è¨ˆç•«

æœ¬æ–‡æª”è¨˜éŒ„ç›®å‰æ¶æ§‹èˆ‡ç†æƒ³æ¶æ§‹çš„å·®ç•°ï¼Œä»¥åŠæ”¹é€²æ­¥é©Ÿã€‚

**å»ºç«‹æ—¥æœŸ**: 2025-12-02
**AWS Region**: ap-northeast-1 (Tokyo)

---

## æ¶æ§‹å°æ¯”ç¸½è¦½

| é …ç›®            | ç›®å‰æ¶æ§‹                | ç†æƒ³æ¶æ§‹                   | å„ªå…ˆç´š |
| --------------- | ----------------------- | -------------------------- | ------ |
| Subnet é¡å‹     | Public Subnet           | Private Subnet             | ğŸŸ¡ ä¸­  |
| Aurora å…¬é–‹å­˜å– | Publicly Accessible     | Private Only               | ğŸŸ¡ ä¸­  |
| æª”æ¡ˆå­˜å„²        | Lambda /tmp (è‡¨æ™‚)      | S3 (æŒä¹…åŒ–)                | ğŸ”´ é«˜  |
| æ–‡ä»¶è™•ç†        | Backend Lambda åŒæ­¥è™•ç† | ç¨ç«‹ File Processor Lambda | ğŸ”´ é«˜  |
| S3 VPC Endpoint | ç„¡                      | Gateway é¡å‹ (å…è²»)        | ğŸ”´ é«˜  |
| è‡ªå®šç¾©åŸŸå      | ç„¡                      | Route 53 + ACM             | ğŸŸ¢ ä½  |
| æœ¬åœ°é€£æ¥ Aurora | ç›´æ¥å…¬ç¶²é€£æ¥            | SSM / Bastion / VPN        | ğŸŸ¡ ä¸­  |

---

## ç›®å‰æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AWS Cloud                                                                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Regional Services (VPC å¤–)                                           â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚   â”‚   â”‚ App Runner     â”‚      â”‚ API Gateway    â”‚                        â”‚   â”‚
â”‚   â”‚   â”‚ (Gradio)       â”‚ â”€â”€â”€â†’ â”‚                â”‚                        â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚   â”‚
â”‚   â”‚                                   â”‚                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ VPC: hr-chatbot                   â”‚                                   â”‚   â”‚
â”‚   â”‚                                   â–¼                                   â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”‚ Public Subnet (Multi-AZ: 1a, 1c) âš ï¸                             â”‚ â”‚   â”‚
â”‚   â”‚  â”‚                                                                  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚ Backend Lambda   â”‚                  â”‚ Aurora PostgreSQL  â”‚  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Publicly          â”‚  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ æ¥æ”¶ API è«‹æ±‚   â”‚                  â”‚  Accessible) âš ï¸    â”‚  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ ä¸Šå‚³åˆ° /tmp âš ï¸ â”‚                  â”‚                    â”‚  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ åŒæ­¥è™•ç† âš ï¸    â”‚                  â”‚ â€¢ pgvector         â”‚  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚            â”‚                                                     â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚ VPC Endpoints                                              â”‚ â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ Secrets Manager (Interface)                            â”‚ â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ Bedrock Runtime (Interface)                            â”‚ â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ âŒ æ²’æœ‰ S3 Endpoint                                     â”‚ â”‚ â”‚   â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚
â”‚   â”‚  â”‚                                                                  â”‚ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                                                                       â”‚   â”‚
â”‚   â”‚   Internet Gateway: igw-06a60cfc67b031251 âš ï¸                         â”‚   â”‚
â”‚   â”‚                                                                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ AWS Services                                                          â”‚  â”‚
â”‚   â”‚  â€¢ Secrets Manager    â€¢ Bedrock (Nova Pro, Cohere Embed v4)          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ = éœ€è¦æ”¹é€²çš„é …ç›®
```

### ç›®å‰æ¶æ§‹çš„å•é¡Œ

| å•é¡Œ                           | å½±éŸ¿                                | é¢¨éšªç­‰ç´š |
| ------------------------------ | ----------------------------------- | -------- |
| **æª”æ¡ˆå­˜åœ¨ /tmp**              | Lambda å›æ”¶å¾Œæª”æ¡ˆæ¶ˆå¤±ï¼Œç„¡æ³•é‡æ–°è™•ç† | ğŸ”´ é«˜    |
| **åŒæ­¥è™•ç† Embedding**         | API å›æ‡‰æ…¢ï¼Œå¤§æª”æ¡ˆå¯èƒ½è¶…æ™‚          | ğŸ”´ é«˜    |
| **Public Subnet**              | è³‡æºæœ‰å…¬ç¶² IPï¼Œæ”»æ“Šé¢è¼ƒå¤§           | ğŸŸ¡ ä¸­    |
| **Aurora Publicly Accessible** | è³‡æ–™åº«æš´éœ²åœ¨å…¬ç¶²                    | ğŸŸ¡ ä¸­    |
| **ç„¡è‡ªå®šç¾©åŸŸå**               | ä½¿ç”¨ AWS é è¨­åŸŸåï¼Œä¸å°ˆæ¥­           | ğŸŸ¢ ä½    |

---

## ç†æƒ³æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AWS Cloud                                                                        â”‚
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Global / Regional Services (VPC å¤–)                                       â”‚  â”‚
â”‚   â”‚                                                                           â”‚  â”‚
â”‚   â”‚        Route 53 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
â”‚   â”‚           â”‚              â”‚                           â”‚                   â”‚  â”‚
â”‚   â”‚        ACM Cert          â”‚                           â”‚                   â”‚  â”‚
â”‚   â”‚           â”‚              â”‚                           â”‚                   â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚   â”‚   â”‚ App Runner   â”‚  â”‚ API Gateway  â”‚   â”‚ S3 Bucket               â”‚      â”‚  â”‚
â”‚   â”‚   â”‚ (Frontend)   â”‚  â”‚ (Backend)    â”‚   â”‚ (åŸå§‹æª”æ¡ˆå­˜å„²)           â”‚      â”‚  â”‚
â”‚   â”‚   â”‚              â”‚  â”‚              â”‚   â”‚                         â”‚      â”‚  â”‚
â”‚   â”‚   â”‚ app.xxx.com  â”‚  â”‚ api.xxx.com  â”‚   â”‚ S3 Event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”˜      â”‚  â”‚
â”‚   â”‚                            â”‚                                  â”‚          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                  â”‚             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ VPC                        â”‚                                  â”‚           â”‚  â”‚
â”‚   â”‚                            â–¼                                  â–¼           â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ Private Subnet (Multi-AZ: 1a, 1c) âœ…                                â”‚ â”‚  â”‚
â”‚   â”‚  â”‚                                                                      â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ Backend Lambda   â”‚      â”‚ File Processor   â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚                  â”‚      â”‚ Lambda           â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ æ¥æ”¶ API è«‹æ±‚   â”‚      â”‚                  â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ ä¸Šå‚³åˆ° S3 âœ…   â”‚      â”‚ â€¢ S3 Event è§¸ç™¼  â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ â€¢ å¿«é€Ÿå›æ‡‰       â”‚      â”‚ â€¢ è§£ææ–‡ä»¶       â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â€¢ Chunking       â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â”‚                â”‚ â€¢ Embedding      â”‚                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â”‚                         â”‚                              â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â”‚    â”‚                                                   â”‚ â”‚  â”‚
â”‚   â”‚  â”‚            â–¼    â–¼                                                   â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ Aurora PostgreSQL (Private Only) âœ…                         â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ pgvector                                                  â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ NOT Publicly Accessible                                   â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚                                                                      â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚ VPC Endpoints                                                 â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ Secrets Manager (Interface)                               â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ Bedrock Runtime (Interface)                               â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â”‚  â€¢ S3 (Gateway - å…è²») âœ…                                     â”‚  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚
â”‚   â”‚  â”‚                                                                      â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                                                                           â”‚  â”‚
â”‚   â”‚   âŒ ä¸éœ€è¦ Internet Gateway                                              â”‚  â”‚
â”‚   â”‚   âŒ ä¸éœ€è¦ NAT Gateway                                                   â”‚  â”‚
â”‚   â”‚                                                                           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ AWS Services                                                              â”‚  â”‚
â”‚   â”‚  â€¢ Secrets Manager    â€¢ Bedrock    â€¢ S3                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… = æ”¹é€²é …ç›®
```

---

## è©³ç´°å·®ç•°å°æ¯”

### 1. ç¶²è·¯æ¶æ§‹

| é …ç›®             | ç›®å‰            | ç†æƒ³             | èªªæ˜                      |
| ---------------- | --------------- | ---------------- | ------------------------- |
| Subnet é¡å‹      | Public          | **Private**      | ç§»é™¤å…¬ç¶²å­˜å–ï¼Œæ›´å®‰å…¨      |
| Internet Gateway | æœ‰              | **ç§»é™¤**         | Private Subnet ä¸éœ€è¦     |
| NAT Gateway      | ç„¡              | **ä¸éœ€è¦**       | æœ‰ VPC Endpoints å°±ä¸éœ€è¦ |
| Route Table      | 0.0.0.0/0 â†’ IGW | **åªæœ‰æœ¬åœ°è·¯ç”±** | ç„¡å…¬ç¶²è·¯ç”±                |

### 2. Aurora é…ç½®

| é …ç›®                | ç›®å‰        | ç†æƒ³                 | èªªæ˜           |
| ------------------- | ----------- | -------------------- | -------------- |
| Publicly Accessible | Yes         | **No**               | å®Œå…¨ç§æœ‰å­˜å–   |
| æœ¬åœ°é€£æ¥æ–¹å¼        | ç›´æ¥å…¬ç¶²    | **SSM/Bastion/VPN**  | å®‰å…¨çš„ç§æœ‰é€£æ¥ |
| Security Group      | å…è¨±æœ¬åœ° IP | **åªå…è¨± Lambda SG** | æœ€å°æ¬Šé™       |

### 3. æª”æ¡ˆè™•ç†

| é …ç›®     | ç›®å‰           | ç†æƒ³                      | èªªæ˜               |
| -------- | -------------- | ------------------------- | ------------------ |
| æª”æ¡ˆå­˜å„² | /tmp (è‡¨æ™‚)    | **S3 (æŒä¹…åŒ–)**           | å¯é‡æ–°è™•ç†ã€ä¸ä¸Ÿå¤± |
| è™•ç†æ–¹å¼ | åŒæ­¥ (Backend) | **ç•°æ­¥ (File Processor)** | API å¿«é€Ÿå›æ‡‰       |
| è§¸ç™¼æ©Ÿåˆ¶ | API å‘¼å«       | **S3 Event**              | è§£è€¦ä¸Šå‚³å’Œè™•ç†     |

### 4. VPC Endpoints

| Endpoint        | ç›®å‰         | ç†æƒ³           | è²»ç”¨     |
| --------------- | ------------ | -------------- | -------- |
| Secrets Manager | âœ… Interface | âœ… Interface   | ~$7.5/æœˆ |
| Bedrock Runtime | âœ… Interface | âœ… Interface   | ~$7.5/æœˆ |
| S3              | âŒ ç„¡        | **âœ… Gateway** | **å…è²»** |

### 5. åŸŸåå’Œè­‰æ›¸

| é …ç›®          | ç›®å‰                 | ç†æƒ³                | èªªæ˜           |
| ------------- | -------------------- | ------------------- | -------------- |
| Frontend åŸŸå | xxx.awsapprunner.com | **app.example.com** | å°ˆæ¥­ã€æ˜“è¨˜     |
| API åŸŸå      | xxx.execute-api.xxx  | **api.example.com** | å°ˆæ¥­ã€æ˜“è¨˜     |
| SSL è­‰æ›¸      | AWS é è¨­             | **ACM (å…è²»)**      | è‡ªå®šç¾©åŸŸåéœ€è¦ |
| DNS ç®¡ç†      | ç„¡                   | **Route 53**        | çµ±ä¸€ç®¡ç†       |

---

## è³‡æ–™æµå°æ¯”

### ç›®å‰æµç¨‹ (åŒæ­¥è™•ç†)

```
ç”¨æˆ¶ä¸Šå‚³æª”æ¡ˆ
    â”‚
    â–¼
Frontend â”€â”€â†’ API Gateway â”€â”€â†’ Backend Lambda
                                   â”‚
                                   â”‚ â‘  å­˜åˆ° /tmp (è‡¨æ™‚)
                                   â”‚ â‘¡ è§£ææ–‡ä»¶
                                   â”‚ â‘¢ Chunking
                                   â”‚ â‘£ å‘¼å« Bedrock Embedding
                                   â”‚ â‘¤ å­˜å…¥ Aurora
                                   â”‚
                                   â”‚ â±ï¸ è€—æ™‚ï¼š30-60 ç§’
                                   â”‚ âš ï¸ å¯èƒ½è¶…æ™‚
                                   â–¼
                              å›æ‡‰ç”¨æˆ¶
```

**å•é¡Œ**ï¼š

- ç”¨æˆ¶ç­‰å¾…æ™‚é–“é•·
- å¤§æª”æ¡ˆå¯èƒ½è¶…é Lambda è¶…æ™‚é™åˆ¶
- åŸå§‹æª”æ¡ˆåœ¨ /tmpï¼ŒLambda å›æ”¶å¾Œæ¶ˆå¤±

### ç†æƒ³æµç¨‹ (ç•°æ­¥è™•ç†)

```
ç”¨æˆ¶ä¸Šå‚³æª”æ¡ˆ
    â”‚
    â–¼
Frontend â”€â”€â†’ API Gateway â”€â”€â†’ Backend Lambda
                                   â”‚
                                   â”‚ â‘  ä¸Šå‚³åˆ° S3
                                   â”‚ â±ï¸ å¿«é€Ÿ (å¹¾ç§’)
                                   â–¼
                              å›æ‡‰ç”¨æˆ¶ "ä¸Šå‚³æˆåŠŸï¼Œè™•ç†ä¸­..."

                                   â•‘
                                   â•‘ S3 Event (PutObject)
                                   â–¼

                            File Processor Lambda
                                   â”‚
                                   â”‚ â‘¡ å¾ S3 è®€å–æª”æ¡ˆ
                                   â”‚ â‘¢ è§£ææ–‡ä»¶
                                   â”‚ â‘£ Chunking
                                   â”‚ â‘¤ å‘¼å« Bedrock Embedding
                                   â”‚ â‘¥ å­˜å…¥ Aurora
                                   â”‚ â‘¦ æ›´æ–°æ–‡ä»¶ç‹€æ…‹
                                   â”‚
                                   â”‚ â±ï¸ èƒŒæ™¯è™•ç†ï¼Œä¸å½±éŸ¿ç”¨æˆ¶
                                   â–¼
                              è™•ç†å®Œæˆ
```

**å„ªé»**ï¼š

- ç”¨æˆ¶å¿«é€Ÿå¾—åˆ°å›æ‡‰
- æ”¯æ´å¤§æª”æ¡ˆè™•ç†
- åŸå§‹æª”æ¡ˆæŒä¹…ä¿å­˜åœ¨ S3
- è™•ç†å¤±æ•—å¯é‡è©¦

---

## æ”¹é€²å¯¦æ–½æ­¥é©Ÿ

### éšæ®µ 1ï¼šæª”æ¡ˆè™•ç†æ”¹é€² (ğŸ”´ é«˜å„ªå…ˆ)

#### 1.1 å‰µå»º S3 Bucket

```bash
aws s3api create-bucket \
    --bucket hr-chatbot-documents-ap-northeast-1 \
    --region ap-northeast-1 \
    --create-bucket-configuration LocationConstraint=ap-northeast-1

# å•Ÿç”¨ç‰ˆæœ¬æ§åˆ¶ (å¯é¸)
aws s3api put-bucket-versioning \
    --bucket hr-chatbot-documents-ap-northeast-1 \
    --versioning-configuration Status=Enabled
```

#### 1.2 å‰µå»º S3 VPC Endpoint (Gateway - å…è²»)

```bash
aws ec2 create-vpc-endpoint \
    --vpc-id vpc-096e9a11b215affa3 \
    --service-name com.amazonaws.ap-northeast-1.s3 \
    --vpc-endpoint-type Gateway \
    --route-table-ids rtb-0a2c110b3e52d0983
```

#### 1.3 å‰µå»º File Processor Lambda

```bash
# å‰µå»ºæ–°çš„ Lambda å‡½æ•¸
aws lambda create-function \
    --function-name hr-chatbot-file-processor \
    --runtime python3.12 \
    --handler handler.lambda_handler \
    --role arn:aws:iam::xxx:role/hr-chatbot-lambda-role \
    --timeout 300 \
    --memory-size 2048 \
    --vpc-config SubnetIds=subnet-0815a8642250d1459,subnet-0b7dc9e7411b5bec4,SecurityGroupIds=sg-0dfc84b0acf5f5565
```

#### 1.4 è¨­å®š S3 Event è§¸ç™¼

```bash
aws s3api put-bucket-notification-configuration \
    --bucket hr-chatbot-documents-ap-northeast-1 \
    --notification-configuration '{
        "LambdaFunctionConfigurations": [{
            "LambdaFunctionArn": "arn:aws:lambda:ap-northeast-1:xxx:function:hr-chatbot-file-processor",
            "Events": ["s3:ObjectCreated:*"],
            "Filter": {
                "Key": {
                    "FilterRules": [{
                        "Name": "prefix",
                        "Value": "uploads/"
                    }]
                }
            }
        }]
    }'
```

#### 1.5 æ›´æ–° Backend Lambda ä¸Šå‚³é‚è¼¯

ä¿®æ”¹ `src/api/routes/upload.py`ï¼š

- ç§»é™¤ /tmp å­˜å„²é‚è¼¯
- æ”¹ç‚ºä¸Šå‚³åˆ° S3
- å¿«é€Ÿå›æ‡‰ç”¨æˆ¶

---

### éšæ®µ 2ï¼šç¶²è·¯å®‰å…¨æ”¹é€² (ğŸŸ¡ ä¸­å„ªå…ˆ)

#### 2.1 å°‡ Subnet æ”¹ç‚º Private

```bash
# ç§»é™¤ Subnet çš„å…¬ç¶² IP è‡ªå‹•åˆ†é…
aws ec2 modify-subnet-attribute \
    --subnet-id subnet-0815a8642250d1459 \
    --no-map-public-ip-on-launch

aws ec2 modify-subnet-attribute \
    --subnet-id subnet-0b7dc9e7411b5bec4 \
    --no-map-public-ip-on-launch

# ç§»é™¤ Route Table çš„ IGW è·¯ç”±
aws ec2 delete-route \
    --route-table-id rtb-0a2c110b3e52d0983 \
    --destination-cidr-block 0.0.0.0/0
```

#### 2.2 é—œé–‰ Aurora Publicly Accessible

```bash
aws rds modify-db-instance \
    --db-instance-identifier hr-chatbot-instance \
    --no-publicly-accessible \
    --apply-immediately
```

#### 2.3 æ›´æ–° Security Group

```bash
# ç§»é™¤æœ¬åœ° IP è¦å‰‡
aws ec2 revoke-security-group-ingress \
    --group-id sg-0dfc84b0acf5f5565 \
    --protocol tcp \
    --port 5432 \
    --cidr 61.222.146.136/32
```

#### 2.4 è¨­å®š SSM Session Manager (æœ¬åœ°é€£æ¥æ›¿ä»£æ–¹æ¡ˆ)

éœ€è¦åœ¨ Private Subnet ä¸­å»ºç«‹ä¸€å€‹ EC2 å¯¦ä¾‹ä½œç‚º Bastionï¼Œæˆ–ä½¿ç”¨ SSMã€‚

---

### éšæ®µ 3ï¼šåŸŸåå’Œè­‰æ›¸ (ğŸŸ¢ ä½å„ªå…ˆ)

#### 3.1 ç”³è«‹ ACM è­‰æ›¸

```bash
aws acm request-certificate \
    --domain-name "*.example.com" \
    --validation-method DNS \
    --region ap-northeast-1
```

#### 3.2 è¨­å®š Route 53

```bash
# å‰µå»º Hosted Zone (å¦‚æœé‚„æ²’æœ‰)
aws route53 create-hosted-zone \
    --name example.com \
    --caller-reference $(date +%s)
```

#### 3.3 è¨­å®š API Gateway è‡ªå®šç¾©åŸŸå

```bash
aws apigatewayv2 create-domain-name \
    --domain-name api.example.com \
    --domain-name-configurations CertificateArn=arn:aws:acm:ap-northeast-1:xxx:certificate/xxx
```

#### 3.4 è¨­å®š App Runner è‡ªå®šç¾©åŸŸå

åœ¨ App Runner Console ä¸­è¨­å®šè‡ªå®šç¾©åŸŸåã€‚

---

## æˆæœ¬å°æ¯”

### ç›®å‰æˆæœ¬ (ä¼°ç®—)

| é …ç›®                               | æœˆæˆæœ¬      |
| ---------------------------------- | ----------- |
| Aurora Serverless v2 (0.5 ACU avg) | ~$44        |
| VPC Endpoints (2 å€‹ Interface)     | ~$15        |
| Lambda                             | ~$5         |
| App Runner                         | ~$10        |
| API Gateway                        | ~$1         |
| **ç¸½è¨ˆ**                           | **~$75/æœˆ** |

### æ”¹é€²å¾Œæˆæœ¬ (ä¼°ç®—)

| é …ç›®                                    | æœˆæˆæœ¬      | è®ŠåŒ–                   |
| --------------------------------------- | ----------- | ---------------------- |
| Aurora Serverless v2                    | ~$44        | ä¸è®Š                   |
| VPC Endpoints (2 Interface + 1 Gateway) | ~$15        | ä¸è®Š (S3 Gateway å…è²») |
| Lambda (Backend + File Processor)       | ~$8         | +$3                    |
| App Runner                              | ~$10        | ä¸è®Š                   |
| API Gateway                             | ~$1         | ä¸è®Š                   |
| S3 (æ–‡ä»¶å­˜å„²)                           | ~$1         | **æ–°å¢**               |
| Route 53                                | ~$0.5       | **æ–°å¢**               |
| ACM                                     | $0          | å…è²»                   |
| **ç¸½è¨ˆ**                                | **~$80/æœˆ** | +$5                    |

**çµè«–**ï¼šæ”¹é€²å¾Œæˆæœ¬åƒ…å¢åŠ ç´„ $5/æœˆï¼Œä½†ç²å¾—æ›´å¥½çš„å®‰å…¨æ€§ã€å¯é æ€§å’Œç”¨æˆ¶é«”é©—ã€‚

---

## é¢¨éšªè©•ä¼°

### éšæ®µ 1 é¢¨éšª (æª”æ¡ˆè™•ç†)

| é¢¨éšª                | å½±éŸ¿         | ç·©è§£æªæ–½           |
| ------------------- | ------------ | ------------------ |
| S3 Event å»¶é²       | è™•ç†å»¶é²å¹¾ç§’ | å¯æ¥å—ï¼ŒéåŒæ­¥è¨­è¨ˆ |
| File Processor å¤±æ•— | æª”æ¡ˆæœªè™•ç†   | S3 Event é‡è©¦æ©Ÿåˆ¶  |
| ç¨‹å¼ç¢¼æ”¹å‹•è¼ƒå¤§      | å¯èƒ½å¼•å…¥ bug | å……åˆ†æ¸¬è©¦           |

### éšæ®µ 2 é¢¨éšª (ç¶²è·¯å®‰å…¨)

| é¢¨éšª                | å½±éŸ¿     | ç·©è§£æªæ–½           |
| ------------------- | -------- | ------------------ |
| ç„¡æ³•æœ¬åœ°é€£æ¥ Aurora | é–‹ç™¼ä¸ä¾¿ | å…ˆè¨­å®š SSM/Bastion |
| æ”¹éŒ¯è¨­å®š            | æœå‹™ä¸­æ–· | åœ¨éå°–å³°æ™‚æ®µæ“ä½œ   |

### éšæ®µ 3 é¢¨éšª (åŸŸå)

| é¢¨éšª         | å½±éŸ¿           | ç·©è§£æªæ–½          |
| ------------ | -------------- | ----------------- |
| DNS å‚³æ’­å»¶é² | æš«æ™‚ç„¡æ³•è¨ªå•   | è¨­å®šè¼ƒä½ TTL      |
| è­‰æ›¸é©—è­‰å¤±æ•— | ç„¡æ³•å•Ÿç”¨ HTTPS | ç¢ºèª DNS è¨­å®šæ­£ç¢º |

---

## æª¢æŸ¥æ¸…å–®

### éšæ®µ 1 å®Œæˆæ¨™æº–

- [ ] S3 Bucket å·²å‰µå»º
- [ ] S3 VPC Endpoint (Gateway) å·²å‰µå»º
- [ ] File Processor Lambda å·²éƒ¨ç½²
- [ ] S3 Event è§¸ç™¼å·²è¨­å®š
- [ ] Backend Lambda å·²æ›´æ–°ä¸Šå‚³é‚è¼¯
- [ ] æª”æ¡ˆä¸Šå‚³æµç¨‹æ¸¬è©¦é€šé
- [ ] æ–‡ä»¶è™•ç†æµç¨‹æ¸¬è©¦é€šé

### éšæ®µ 2 å®Œæˆæ¨™æº–

- [ ] SSM/Bastion å·²è¨­å®šä¸¦æ¸¬è©¦
- [ ] Subnet å·²æ”¹ç‚º Private
- [ ] Aurora Publicly Accessible å·²é—œé–‰
- [ ] Security Group å·²æ›´æ–°
- [ ] Lambda åŠŸèƒ½æ­£å¸¸
- [ ] Aurora é€£æ¥æ­£å¸¸

### éšæ®µ 3 å®Œæˆæ¨™æº–

- [ ] ACM è­‰æ›¸å·²ç”³è«‹ä¸¦é©—è­‰
- [ ] Route 53 Hosted Zone å·²è¨­å®š
- [ ] API Gateway è‡ªå®šç¾©åŸŸåå·²è¨­å®š
- [ ] App Runner è‡ªå®šç¾©åŸŸåå·²è¨­å®š
- [ ] DNS è¨˜éŒ„å·²å‰µå»º
- [ ] HTTPS è¨ªå•æ­£å¸¸

---

## åƒè€ƒè³‡æº

- [Aurora Serverless v2 Documentation](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless-v2.html)
- [Lambda VPC Configuration](https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html)
- [S3 Event Notifications](https://docs.aws.amazon.com/AmazonS3/latest/userguide/NotificationHowTo.html)
- [VPC Endpoints](https://docs.aws.amazon.com/vpc/latest/privatelink/aws-services-privatelink-support.html)
- [Route 53 Documentation](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/Welcome.html)
- [ACM Documentation](https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html)

---

**æ–‡æª”ç¶­è­·è€…**: Ting Zhang
**æœ€å¾Œæ›´æ–°**: 2025-12-02
